---
title: "CSE 160 Final Project"
author:
  - Hamza Ali
  - Wajid Ashraf
  - Jeremy Learner
  - Buckley Ross
  - Tyler Waldvogel
date: "11/29/2021"
output: html_document
---


## R Markdown

```{r}
library(ggplot2)
data_raw <- read.csv("movies_metadata.csv")
data_raw <- data_raw[data_raw$status=="Released",]
data <- data_raw[data_raw$vote_count>800,-c(1, 6, 7, 9, 10, 12, 18, 19, 20, 22)]
data <- data[data$revenue>0,]
data <- data[data$budget>1000,]
data$popularity <- as.double(data$popularity)
data$budget <- as.double(data$budget)
data$belongs_to_collection <- !(data$belongs_to_collection=="")
data$homepage <- !(data$homepage == "")
data$genres <- gsub("[[:space:]]", "", data$genres)

data$Action <- grepl('Action', data$genres, fixed = TRUE); data$Adventure <- grepl('Adventure', data$genres, fixed = TRUE); data$Animation <- grepl('Animation', data$genres, fixed = TRUE); data$Comedy <- grepl('Comedy', data$genres, fixed = TRUE); data$Crime <- grepl('Crime', data$genres, fixed = TRUE); data$Drama <- grepl('Drama', data$genres, fixed = TRUE); data$Family <- grepl('Family', data$genres, fixed = TRUE); data$Fantasy <- grepl('Fantasy', data$genres, fixed = TRUE); data$History <- grepl('History', data$genres, fixed = TRUE); data$Horror <- grepl('Horror', data$genres, fixed = TRUE); data$Music <- grepl('Music', data$genres, fixed = TRUE); data$Mystery <- grepl('Mystery', data$genres, fixed = TRUE); data$Romance <- grepl('Romance', data$genres, fixed = TRUE); data$Science_Fiction <- grepl('ScienceFiction', data$genres, fixed = TRUE); data$Thriller <- grepl('Thriller', data$genres, fixed = TRUE); data$War <- grepl('War', data$genres, fixed = TRUE); data$Western <- grepl('Western', data$genres, fixed = TRUE);
data <- data[,-c(3,7,8)]

data$release_date <- as.Date(data$release_date)
data$year = as.numeric(format(data$release_date, format = "%Y"));
data$month = as.numeric(format(data$release_date, format = "%m"));
data$day = as.numeric(format(data$release_date, format = "%d"));

data$ratio <- (data$revenue/data$budget)
data$is_successful <- (data$ratio > 4)

data$is_English <- data$original_language == "en"
data$original_language <- NULL
```

```{r}
library(caTools)
library(ROCR)
library(e1071)

data <- data[,-4]
split <- sample(2, nrow(data), replace = TRUE, prob = c(.8, .2))
trainData <- data[split == 1,]
testData <- data[split == 2,]
#NB
nb <- naiveBayes(formula = as.factor(belongs_to_collection) ~., data = trainData)
pNB <- predict(nb, newdata = testData, type = 'raw')
curveNB <- prediction(pNB[,2], testData$belongs_to_collection)
performanceNB <- performance(curveNB, 'tpr', 'fpr')
regressionModel <- glm(belongs_to_collection ~ Action+Adventure+Animation+Comedy+Crime+Drama+Family+Fantasy+History+Horror+Music+Mystery+Romance+Science_Fiction+Thriller+War+Western, data = trainData, family = "binomial")
pred <- predict(regressionModel, testData, type = "response")
t <-table(data.frame(testData$belongs_to_collection, pred > .5))
curveLR <- prediction(pred, testData$belongs_to_collection)
performanceLR <- performance(curveLR, 'tpr', 'fpr')
plot(performanceNB, col = 1, main = "ROC")
plot(performanceLR, col = 2, add = T)
legend(.6,.3,c('Naive Bayes', 'Logistic Regression'), 1:2)

```


## Including Plots

You can also embed plots, for example:

```{r}
library(ggplot2)
revenuemodel <- lm(revenue~budget+popularity+vote_count,data = data)

summary(revenuemodel) #chose those variables because they had the highest r squared
plot(revenuemodel)


genres1 <-c(mean(data$ratio[data$Action==TRUE]), mean(data$ratio[data$Adventure==TRUE]), mean(data$ratio[data$Animation==TRUE]), mean(data$ratio[data$Comedy==TRUE]), mean(data$ratio[data$Crime==TRUE]), mean(data$ratio[data$Drama==TRUE]), mean(data$ratio[data$Family==TRUE]), mean(data$ratio[data$Fantasy==TRUE]), mean(data$ratio[data$History==TRUE]), mean(data$ratio[data$Horror==TRUE]), mean(data$ratio[data$Music==TRUE]), mean(data$ratio[data$Mystery==TRUE]), mean(data$ratio[data$Romance==TRUE]), mean(data$ratio[data$Science_Fiction==TRUE]), mean(data$ratio[data$Thriller==TRUE]),mean(data$ratio[data$War==TRUE]), mean(data$ratio[data$War==TRUE]), mean(data$ratio[data$Western==TRUE]))
p<-ggplot(data=data, aes(x=genres1, y=revenue)) +
  geom_bar(stat="identity")
p
en <- length(data$original_language[data$original_language=="en"])
en <- (en/1344)*100


b <- table(data$original_language)

b <- 100 * b/nrow(data)
b
group <- unique((data$original_language))
group
ggplot(data, aes(x="", y=b, fill=group)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  
  theme_void() # remove background, grid, numeric labels







```

